<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv='cache-control' content='no-cache'> 
  <meta http-equiv='expires' content='0'> 
  <meta http-equiv='pragma' content='no-cache'>
  <title>Reaper: Calculadora Slugterra</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
    } 
    select, button {
      margin: 10px;
      padding: 8px;
      font-size: 16px;
    }
    .grilla {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 40px;
      justify-items: center;
      align-items: start;
    }
    .babosa {
      border: 2px solid #ccc;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 350px;
      background: #e7e7e7;
    }
    .babosa-data {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .babosa-img {
      width: 150px;
      height: 150px;
      object-fit: contain;
    }
    .stats {
      margin-top: 15px;
      text-align: left;
      font-family: monospace;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h1>Calculadora Bajoterra: Renegados del Abismo</h1>

  <div class="grilla">
    <!-- Babosa 1 (o atacante) -->
    <div class="babosa">
      <h2>Babosa 1</h2>
      <select id="slug1"></select>
      <label>
        <input type="checkbox" id="malvada1">¿Es una malvada?
      </label>
      <button onclick="seleccionarBabosa(1)">Aceptar</button>
      <div class="babosa-data">
        <img id="foto1" class="babosa-img" src="" alt="Babosa 1">
        <div class="stats" id="stats1"></div>
      </div>
    </div>

    <!-- Imagen VS -->
    <div class="versus">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJexbE-SkWpxNOgfKhpZoSI0ljuCb0TFgUeQ&s"
         alt=""
         style="width: 200px; margin-top: 60px;">
    </div>

    <!-- Babosa 2 (o defensora) -->
    <div class="babosa">
      <h2>Babosa 2</h2>
      <select id="slug2"></select>
      <label>
        <input type="checkbox" id="malvada2">¿Es una malvada?
      </label>
      <button onclick="seleccionarBabosa(2)">Aceptar</button>
      <div class="babosa-data">
        <img id="foto2" class="babosa-img" src="" alt="Babosa 2">
        <div class="stats" id="stats2"></div>
      </div>
    </div>
  </div>
  <script src="babosas.js?v=1"></script>
  <script src="complementos.js?v=1"></script>
  <script src="script.js"></script>

  <h5>Me da pereza hacer que se vea bien la página con fondos y todo eso. Pero si les duelen los ojos al verla avisen y lo cambio.</h5>









<body>

<div class="container">
<h1>Babosas de Bajoterra</h1>
<div class="selectors">
    <select id="puras"><option value="">Cargando babosas puras...</option></select>
    <select id="malvadas"><option value="">Cargando babosas malvadas...</option></select>
</div>
<div class="babosa-info" id="babosa-info"><p>Selecciona una babosa para ver sus datos.</p></div>
</div>

<script>
// Cache para no recargar babosas seleccionadas
const cacheBabosas = {};

// Función para obtener babosas desde la API de Fandom
async function obtenerBabosasDesdeCategoriaAPI(category) {
    const url = `https://bajoterra.fandom.com/api.php?action=query&list=categorymembers&cmtitle=${encodeURIComponent(category)}&cmlimit=500&format=json`;
    const res = await fetch(url);
    const data = await res.json();
    return data.query.categorymembers.map(item => ({
        nombre: item.title,
        url: `https://bajoterra.fandom.com/wiki/${encodeURIComponent(item.title.replace(/ /g, '_'))}`
    }));
}

// Función para obtener datos de una babosa al seleccionarla
async function obtenerDatosBabosa(url) {
    if (cacheBabosas[url]) return cacheBabosas[url];
    
    // Fetch del HTML de la babosa usando AllOrigins para CORS
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    const res = await fetch(proxyUrl);
    const data = await res.json();
    const doc = new DOMParser().parseFromString(data.contents, 'text/html');

    const img = doc.querySelector('.pi-image-thumbnail') || doc.querySelector('.wikia-gallery-item img');
    const png = img ? img.src : '';
    const nombre = doc.querySelector('.page-header__title')?.textContent.trim() || '';
    const infobox = doc.querySelector('.portable-infobox');
    let descripcion = '';
    if (infobox) {
        descripcion = Array.from(infobox.querySelectorAll('h3,h4,p')).map(el => el.textContent.trim()).join('\n');
    }

    const datos = { nombre, png, descripcion };
    cacheBabosas[url] = datos;
    return datos;
}

// Llenar selectores
function llenarSelector(selectId, babosas) {
    const select = document.getElementById(selectId);
    select.innerHTML = "<option value=''>Selecciona...</option>";
    babosas.forEach(b => {
        const option = document.createElement('option');
        option.value = b.url;
        option.textContent = b.nombre;
        select.appendChild(option);
    });
}

// Mostrar info al seleccionar
async function mostrarInfo(url) {
    const infoDiv = document.getElementById('babosa-info');
    infoDiv.innerHTML = "<p>Cargando datos...</p>";
    const datos = await obtenerDatosBabosa(url);
    infoDiv.innerHTML = `
        <h2>${datos.nombre}</h2>
        ${datos.png ? `<img src="${datos.png}" alt="${datos.nombre}">` : ''}
        <pre>${datos.descripcion}</pre>
    `;
}

// Inicialización
async function init() {
    // Obtener babosas puras y malvadas vía API
    const puras = await obtenerBabosasDesdeCategoriaAPI('Category:Babosas_puras');
    const malvadas = await obtenerBabosasDesdeCategoriaAPI('Category:Babosas_Malvadas');

    llenarSelector('puras', puras);
    llenarSelector('malvadas', malvadas);

    document.getElementById('puras').addEventListener('change', e => {
        if (e.target.value) mostrarInfo(e.target.value);
    });
    document.getElementById('malvadas').addEventListener('change', e => {
        if (e.target.value) mostrarInfo(e.target.value);
    });
}

// Ejecutar inicialización
init();
</script>

</body>








  
</body>


</html>










